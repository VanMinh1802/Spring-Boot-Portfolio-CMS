<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title th:text="${post.title}">Chi tiết bài viết</title>
        <link rel="icon" type="image/png" href="/favicon.png">

        <!-- CSS Libraries -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

        <!-- Custom CSS (Dark Mode) -->
        <style>
            :root {
                --bg-color: #f8f9fa;
                --text-color: #212529;
                --card-bg: #ffffff;
            }
            [data-theme="dark"] {
                --bg-color: #121212;
                --text-color: #e0e0e0;
                --card-bg: #1e1e1e;
            }
            body {
                font-family: 'Poppins', sans-serif;
                background-color: var(--bg-color);
                color: var(--text-color);
                transition: 0.3s;
            }
            .card {
                background-color: var(--card-bg);
                color: var(--text-color);
                border: none;
            }
            /* Nội dung bài viết */
            .content-body img {
                max-width: 100%;
                height: auto;
                border-radius: 8px;
            }
        </style>
    </head>
    <body>
        <!-- Navbar đơn giản -->
        <nav class="navbar navbar-dark bg-dark mb-4 shadow">
            <div class="container">
                <a class="navbar-brand" href="/">My Portfolio</a>
                <div>
                    <a href="/blog" class="btn btn-outline-light btn-sm me-2">Quay lại Blog</a>
                    <!-- Dark Mode Toggle -->
                    <button class="btn btn-outline-light btn-sm border-0" id="theme-toggle"><i class="bi bi-moon-stars-fill" id="theme-icon"></i></button>
                </div>
            </div>
        </nav>

        <div class="container mb-5">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <!-- Ảnh bìa -->
                    <img th:if="${post.imageUrl}" th:src="${post.imageUrl}" class="w-100 rounded mb-4 shadow" style="object-fit: cover; max-height: 400px;">

                    <!-- Tiêu đề -->
                    <h1 class="fw-bold mb-2" th:text="${post.title}">Tiêu đề</h1>
                    <p class="text-muted mb-4">
                        <i class="bi bi-clock"></i> Đăng ngày: <span th:text="${#temporals.format(post.createdTime, 'dd-MM-yyyy HH:mm')}"></span>
                    </p>

                    <!-- Tóm tắt -->
                    <div class="alert alert-primary border-start border-4 mb-4">
                        <strong th:text="${post.summary}"></strong>
                    </div>

                    <!-- Nội dung chính (Render HTML) -->
                    <div class="fs-5 lh-lg mb-5 content-body" style="white-space: pre-wrap;" th:utext="${post.content}"></div>

                    <hr>

                    <!-- BÌNH LUẬN -->
                    <div class="mt-5">
                        <h3 class="mb-4">Bình luận</h3>

                        <!-- Thông báo -->
                        <div th:if="${param.comment_success}" class="alert alert-success">
                            Bình luận đã gửi và đang chờ duyệt.
                        </div>

                        <!-- Form -->
                        <div class="card shadow-sm mb-4">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Ý kiến của bạn</h5>
                                <form th:action="@{/blog/{id}/comment(id=${post.id})}" th:object="${newComment}" method="POST">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <input type="text" th:field="*{name}" class="form-control mb-2" placeholder="Tên của bạn" required>
                                        </div>
                                        <div class="col-md-6">
                                            <input type="email" th:field="*{email}" class="form-control" placeholder="Email (sẽ ẩn)" required>
                                        </div>
                                    </div>
                                    <textarea th:field="*{content}" class="form-control mb-3" rows="3" placeholder="Viết bình luận..." required></textarea>
                                    <button type="submit" class="btn btn-primary">Gửi bình luận</button>
                                </form>
                            </div>
                        </div>

                        <!-- List Comments -->
                        <div th:each="cmt : ${comments}" class="d-flex mb-4 p-3 rounded" style="background-color: var(--card-bg);">
                            <div class="flex-shrink-0">
                                <img class="rounded-circle" src="https://ui-avatars.com/api/?background=random&name=User" width="50" />
                            </div>
                            <div class="ms-3">
                                <div class="fw-bold" th:text="${cmt.name}">Name</div>
                                <span class="text-muted small" th:text="${#temporals.format(cmt.createdDate, 'dd-MM-yyyy HH:mm')}">Date</span>
                                <p class="mt-1 mb-0" th:text="${cmt.content}">Nội dung...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Script Dark Mode -->
        <script>
            // (Copy logic Dark Mode từ file trên vào đây)
            const toggleBtn = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            const body = document.body;
            const currentTheme = localStorage.getItem('theme');
            if (currentTheme) {
                body.setAttribute('data-theme', currentTheme);
                if (currentTheme === 'dark')
                    themeIcon.classList.replace('bi-moon-stars-fill', 'bi-sun-fill');
            }
            toggleBtn.addEventListener('click', () => {
                if (body.getAttribute('data-theme') === 'dark') {
                    body.removeAttribute('data-theme');
                    themeIcon.classList.replace('bi-sun-fill', 'bi-moon-stars-fill');
                    localStorage.setItem('theme', 'light');
                } else {
                    body.setAttribute('data-theme', 'dark');
                    themeIcon.classList.replace('bi-moon-stars-fill', 'bi-sun-fill');
                    localStorage.setItem('theme', 'dark');
                }
            });
        </script>
    </body>
</html>