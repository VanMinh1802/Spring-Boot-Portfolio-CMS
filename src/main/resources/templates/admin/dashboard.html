<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>Dashboard Quản trị</title>
        <link rel="icon" type="image/png" href="/favicon.png">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <!-- CSS Dark Mode Chuẩn -->
        <style>
            :root {
                --bg-color: #f8f9fa;
                --text-color: #212529;
                --card-bg: #ffffff;
            }
            [data-theme="dark"] {
                --bg-color: #121212;
                --text-color: #e0e0e0;
                --card-bg: #1e1e1e;
            }
            body {
                font-family: sans-serif;
                background-color: var(--bg-color);
                color: var(--text-color);
                transition: 0.3s;
            }
            .card {
                background-color: var(--card-bg);
                color: var(--text-color);
                border: none;
            }
            .bg-custom-dark {
                background-color: #212529 !important;
            }
        </style>
    </head>
    <body>
        <!-- Navbar Admin -->
        <nav class="navbar navbar-dark bg-custom-dark mb-4 p-3">
            <div class="container-fluid">
                <span class="navbar-brand mb-0 h1 fw-bold">Admin Dashboard</span>
                <div class="d-flex align-items-center">
                    <button class="btn btn-outline-light btn-sm border-0 me-3" id="theme-toggle"><i class="bi bi-moon-stars-fill" id="theme-icon"></i></button>
                    <a th:href="@{/}" class="btn btn-outline-light btn-sm me-2">Xem Website</a>
                    <form th:action="@{/logout}" method="POST" class="m-0">
                        <button type="submit" class="btn btn-danger btn-sm">Đăng xuất</button>
                    </form>
                </div>
            </div>
        </nav>

        <div class="container">
            <!-- Thông báo Server UP -->
            <div class="alert alert-secondary d-flex justify-content-between align-items-center py-2 shadow-sm">
                <span><i class="bi bi-hdd-rack-fill"></i> Server Status: <strong class="text-success">Running</strong></span>
                <small>Uptime: <span th:text="${uptime}">0h 0m</span></small>
            </div>

            <div class="row mb-4">
                <div class="col-12">
                    <h3 class="fw-light">Xin chào, <span class="fw-bold">Admin</span>!</h3>
                </div>
            </div>

            <!-- HÀNG THỐNG KÊ -->

            <!-- HÀNG 1: QUẢN LÝ NỘI DUNG (3 CỘT) -->
            <div class="row g-4 mb-4">

                <!-- Card 1: Dự án -->
                <div class="col-md-4">
                    <div class="card text-white bg-primary h-100 shadow-sm">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <div>
                                <h5 class="card-title"><i class="bi bi-briefcase-fill"></i> Dự án</h5>
                                <h2 class="display-4 fw-bold" th:text="${countProjects}">0</h2>
                            </div>
                            <a th:href="@{/admin/projects}" class="text-white text-decoration-none mt-3">Quản lý ngay &rarr;</a>
                        </div>
                    </div>
                </div>

                <!-- Card 2: Bài viết -->
                <div class="col-md-4">
                    <div class="card text-white bg-success h-100 shadow-sm">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <div>
                                <h5 class="card-title"><i class="bi bi-pen-fill"></i> Bài viết</h5>
                                <h2 class="display-4 fw-bold" th:text="${countBlogs}">0</h2>
                            </div>
                            <div class="d-flex justify-content-between align-items-end">
                                <a th:href="@{/admin/blogs}" class="text-white text-decoration-none">Quản lý &rarr;</a>
                                <!--<a th:href="@{/admin/comments}" class="btn btn-sm btn-light text-success bg-white border-0">
                                    <i class="bi bi-chat-dots-fill"></i> Duyệt comment
                                </a>-->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card 3: Kỹ năng -->
                <div class="col-md-4">
                    <div class="card text-white bg-info h-100 shadow-sm">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <div>
                                <h5 class="card-title"><i class="bi bi-lightning-fill"></i> Kỹ năng</h5>
                                <h2 class="display-4 fw-bold" th:text="${countSkills}">0</h2>
                            </div>
                            <a th:href="@{/admin/skills}" class="text-white text-decoration-none mt-3">Cập nhật &rarr;</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- HÀNG 2: TƯƠNG TÁC & SỐ LIỆU (2 CỘT TO) -->
            <div class="row g-4">

                <!-- Card 4: Hộp thư -->
                <div class="col-md-6">
                    <div class="card text-white bg-warning h-100 shadow-sm">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <div>
                                <h5 class="card-title text-dark"><i class="bi bi-envelope-fill"></i> Hộp thư đến</h5>
                                <h2 class="display-4 fw-bold text-dark" th:text="${countMessages}">0</h2>
                            </div>
                            <a th:href="@{/admin/messages}" class="text-dark text-decoration-none mt-3">Xem tin nhắn &rarr;</a>
                        </div>
                    </div>
                </div>

                <!-- Card 5: Lượt truy cập -->
                <div class="col-md-6">
                    <div class="card text-white bg-danger h-100 shadow-sm">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <div>
                                <h5 class="card-title"><i class="bi bi-eye-fill"></i> Lượt truy cập</h5>
                                <h2 class="display-4 fw-bold" th:text="${countVisits}">0</h2>
                            </div>
                            <small class="text-white-50">Tổng lượt xem toàn trang</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BIỂU ĐỒ -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">Thống kê nội dung</h5>
                            <canvas id="myChart"></canvas>
                        </div>
                    </div>
                </div>
                <!-- Card Lối tắt -->
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="card-header fw-bold">Cài đặt nhanh</div>
                        <div class="card-body">
                            <div class="d-grid gap-3">
                                <a th:href="@{/admin/profile}" class="btn btn-outline-secondary text-start p-3">
                                    <i class="bi bi-person-lines-fill me-2"></i> Cập nhật Hồ sơ
                                </a>
                                <a th:href="@{/admin/comments}" class="btn btn-outline-info text-start p-3">
                                    <i class="bi bi-chat-dots-fill me-2"></i> Duyệt Bình luận
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCRIPTS -->
        <script th:inline="javascript">
            // Chart JS
            var pCount = [[${countProjects
            }
            ]];
            var bCount = [[${countBlogs
            }
            ]];
            var mCount = [[${countMessages
            }
            ]];
            var sCount = [[${countSkills
            }
            ]];
            const ctx = document.getElementById('myChart');
            new Chart(ctx, {
            type: 'doughnut',
                    data: {
                    labels: ['Dự án', 'Bài viết', 'Tin nhắn', 'Kỹ năng'],
                            datasets: [{
                            data: [pCount, bCount, mCount, sCount],
                                    backgroundColor: ['#0d6efd', '#198754', '#ffc107', '#0dcaf0']
                            }]
                    }
            });
            // Dark Mode Script (Copy từ trên)
            const toggleBtn = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            const body = document.body;
            const currentTheme = localStorage.getItem('theme');
            if (currentTheme) {
            body.setAttribute('data-theme', currentTheme);
            if (currentTheme === 'dark')
                    themeIcon.classList.replace('bi-moon-stars-fill', 'bi-sun-fill');
            }
            toggleBtn.addEventListener('click', () => {
            if (body.getAttribute('data-theme') === 'dark') {
            body.removeAttribute('data-theme');
            themeIcon.classList.replace('bi-sun-fill', 'bi-moon-stars-fill');
            localStorage.setItem('theme', 'light');
            } else {
            body.setAttribute('data-theme', 'dark');
            themeIcon.classList.replace('bi-moon-stars-fill', 'bi-sun-fill');
            localStorage.setItem('theme', 'dark');
            }
            });
        </script>
    </body>
</html>