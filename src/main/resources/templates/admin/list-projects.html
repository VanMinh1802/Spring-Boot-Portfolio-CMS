<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>Quản lý Dự án</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <link rel="icon" type="image/png" href="/favicon.png">

        <style>
            :root {
                --bg-color: #f8f9fa;
                --text-color: #212529;
            }
            [data-theme="dark"] {
                --bg-color: #121212;
                --text-color: #e0e0e0;
            }
            /* Dark mode cho bảng */
            [data-theme="dark"] .table {
                color: #e0e0e0;
                border-color: #373b3e;
            }
            [data-theme="dark"] .table-light th {
                background-color: #2c3034;
                color: #e0e0e0;
                border-color: #373b3e;
            }
            body {
                background-color: var(--bg-color);
                color: var(--text-color);
                font-family: sans-serif;
            }
        </style>
    </head>
    <body class="container mt-4">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Quản lý Dự án</h1>
            <a th:href="@{/admin/dashboard}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Dashboard
            </a>
        </div>

        <!-- Actions -->
        <div class="mb-3 d-flex justify-content-between">
            <a th:href="@{/admin/projects/new}" class="btn btn-primary"><i class="bi bi-plus-lg"></i> Thêm Mới</a>
            <form th:action="@{/admin/projects}" method="GET" class="d-flex">
                <input type="text" name="keyword" th:value="${keyword}" class="form-control me-2" placeholder="Tìm kiếm...">
                <button type="submit" class="btn btn-secondary">Tìm</button>
            </form>
        </div>

        <!-- Table -->
        <table class="table table-striped table-bordered align-middle">
            <thead class="table-light">
                <tr><th>ID</th><th>Tiêu đề</th><th>Mô tả</th><th>Hành động</th></tr>
            </thead>
            <tbody>
                <tr th:each="project : ${projectPage.content}">
                    <td th:text="${project.id}"></td>
                    <td th:text="${project.title}" class="fw-bold"></td>
                    <td th:text="${project.description}"></td>
                    <td>
                        <a th:href="@{/admin/projects/edit/{id}(id=${project.id})}" class="btn btn-info btn-sm text-white">Sửa</a>
                        <a th:href="@{/admin/projects/delete/{id}(id=${project.id})}"
                           class="btn btn-danger btn-sm"
                           th:data-name="${project.title}"
                           onclick="confirmDelete(event, this)">Xóa</a>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Pagination (Giữ nguyên logic phân trang cũ của bạn) -->
        <nav th:if="${projectPage.totalPages > 0}">
            <ul class="pagination">
                <li class="page-item" th:each="i : ${#numbers.sequence(0, projectPage.totalPages - 1)}"
                    th:classappend="${i == projectPage.number} ? 'active'">
                    <a class="page-link" th:href="@{/admin/projects(keyword=${keyword}, page=${i})}" th:text="${i + 1}"></a>
                </li>
            </ul>
        </nav>

        <script>
            // Auto Dark Mode
            if (localStorage.getItem('theme') === 'dark')
                document.body.setAttribute('data-theme', 'dark');

            // Delete Logic
            function confirmDelete(event, element) {
                event.preventDefault();
                const deleteUrl = element.getAttribute('href');
                const itemName = element.getAttribute('data-name') || 'mục này';
                Swal.fire({
                    title: 'Bạn có chắc không?',
                    text: "Xóa " + itemName + "? Dữ liệu không thể phục hồi!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    confirmButtonText: 'Vâng, xóa!'
                }).then((result) => {
                    if (result.isConfirmed)
                        window.location.href = deleteUrl;
                })
            }
        </script>
    </body>
</html>