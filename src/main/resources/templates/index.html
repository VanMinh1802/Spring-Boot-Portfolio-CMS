<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title th:text="${profile.fullName} + ' - Portfolio'">Portfolio</title>
        <link rel="icon" type="image/png" href="/favicon.png">

        <!-- =================================================================================
             PHẦN 1: THƯ VIỆN CSS (EXTERNAL LIBRARIES)
        ================================================================================== -->
        <!-- 1. Bootstrap CSS (Giao diện chính) -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <!-- 2. Bootstrap Icons (Icon hệ thống) -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
        <!-- 3. AOS CSS (Hiệu ứng cuộn trang) -->
        <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
        <!-- 4. Google Fonts (Font chữ Poppins) -->
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
        <!-- 5. SweetAlert2 CSS (Thông báo đẹp) -->
        <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">

        <!-- =================================================================================
             PHẦN 2: CSS TÙY CHỈNH (CUSTOM STYLES)
        ================================================================================== -->
        <style>
            /* --- 2.1. KHAI BÁO BIẾN MÀU SẮC (CSS VARIABLES) --- */
            :root {
                /* Chế độ Sáng (Light Mode - Mặc định) */
                --bg-color: #f8f9fa;
                --text-color: #212529;
                --card-bg: #ffffff;
                --card-shadow: rgba(0,0,0,0.1);
                --navbar-bg: #212529;
            }

            /* Chế độ Tối (Dark Mode) */
            [data-theme="dark"] {
                --bg-color: #121212;       /* Đen sâu */
                --text-color: #e0e0e0;     /* Trắng xám */
                --card-bg: #1e1e1e;        /* Xám đậm */
                --card-shadow: rgba(255,255,255,0.1);
                --navbar-bg: #000000;
            }

            /* --- 2.2. CẤU HÌNH CHUNG (GLOBAL STYLES) --- */
            body {
                font-family: 'Poppins', sans-serif;
                background-color: var(--bg-color);
                color: var(--text-color);
                /* Hiệu ứng chuyển màu mượt mà khi đổi theme */
                transition: background-color 0.3s, color 0.3s;
                overflow-x: hidden; /* Chặn thanh cuộn ngang do hiệu ứng AOS */
            }

            /* --- 2.3. CÁC COMPONENT (THÀNH PHẦN) --- */

            /* Card (Thẻ dự án/tin nhắn) */
            .card {
                background-color: var(--card-bg);
                color: var(--text-color);
                border: none;
                transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s;
            }
            .card:hover {
                transform: translateY(-5px); /* Bay lên nhẹ khi di chuột */
                box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
            }

            /* Nút bấm (Bo tròn) */
            .btn {
                border-radius: 50px;
                padding-left: 20px;
                padding-right: 20px;
            }

            /* Class nền tùy chỉnh (Thay thế bg-light của Bootstrap để hỗ trợ Dark Mode) */
            .bg-custom-light {
                background-color: var(--card-bg);
                color: var(--text-color);
                transition: background-color 0.3s, color 0.3s;
            }
        </style>
    </head>

    <body class="d-flex flex-column min-vh-100">

        <!-- =================================================================================
             PHẦN 3: CÁC THÀNH PHẦN GIAO DIỆN (UI COMPONENTS)
        ================================================================================== -->

        <!-- 3.1. MÀN HÌNH CHỜ (PRELOADER) -->
        <div id="preloader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #ffffff; z-index: 9999; display: flex; justify-content: center; align-items: center;">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>

        <!-- 3.2. THANH ĐIỀU HƯỚNG (NAVBAR) -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top shadow">
            <div class="container">
                <a class="navbar-brand fw-bold" href="/">My Portfolio</a>

                <!-- Nút Menu Mobile -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarNav">
                    <div class="ms-auto d-flex gap-2 align-items-center mt-3 mt-lg-0">

                        <!-- Link Blog Public -->
                        <a th:href="@{/blog}" class="btn btn-outline-light btn-sm border-0">Blog</a>

                        <!-- Nút Chuyển Ngôn Ngữ -->
                        <div class="me-2">
                            <a href="?lang=vi" class="text-decoration-none me-2 text-white-50 hover-white">vn</a>
                            <a href="?lang=en" class="text-decoration-none text-white-50 hover-white">us</a>
                        </div>

                        <!-- Nút Chuyển Giao Diện (Dark Mode) -->
                        <button class="btn btn-outline-light btn-sm border-0 me-2" id="theme-toggle" title="Đổi giao diện">
                            <i class="bi bi-moon-stars-fill" id="theme-icon"></i>
                        </button>

                        <!-- TRƯỜNG HỢP 1: CHƯA ĐĂNG NHẬP -->
                        <div sec:authorize="!isAuthenticated()">
                            <a th:href="@{/login}" class="btn btn-outline-light btn-sm">
                                <i class="bi bi-box-arrow-in-right"></i> <span th:text="#{menu.login}">Đăng nhập</span>
                            </a>
                        </div>

                        <!-- TRƯỜNG HỢP 2: ĐÃ ĐĂNG NHẬP -->
                        <div sec:authorize="isAuthenticated()" class="d-flex gap-2 align-items-center">
                            <span class="text-white-50 me-2 small d-none d-lg-inline">
                                <span th:text="#{menu.greeting}">Xin chào,</span>
                                <span sec:authentication="name" class="text-white fw-bold"></span>
                            </span>

                            <!-- Nút vào trang Admin (Chỉ hiện cho Admin) -->
                            <a sec:authorize="hasRole('ADMIN')" th:href="@{/admin/dashboard}" class="btn btn-warning btn-sm">
                                <i class="bi bi-speedometer2"></i> Dashboard
                            </a>

                            <!-- Nút Đăng xuất -->
                            <form th:action="@{/logout}" method="POST" class="m-0">
                                <button type="submit" class="btn btn-danger btn-sm">
                                    <i class="bi bi-power"></i> Đăng xuất
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- 3.3. HEADER PROFILE (THÔNG TIN CÁ NHÂN) -->
        <header class="bg-custom-light p-5 text-center mb-4">
            <div th:if="${profile.avatarUrl}">
                <img th:src="${profile.avatarUrl}" class="rounded-circle mb-3 shadow" data-aos="zoom-in" width="150" height="150" style="object-fit: cover;">
            </div>
            <h1 th:text="${profile.fullName}" class="fw-bold" data-aos="fade-down">Tên Của Bạn</h1>

            <!-- Hiệu ứng gõ chữ -->
            <p class="lead">
                <span th:text="#{profile.intro}">I am</span>
                <span id="typed-text" class="text-primary fw-bold"></span>
            </p>

            <p th:text="${profile.bio}" class="mx-auto" style="max-width: 600px;">Bio...</p>

            <!-- Các nút liên kết MXH -->
            <div class="mt-3 d-flex justify-content-center gap-2">
                <a th:if="${profile.githubUrl}" th:href="${profile.githubUrl}" class="btn btn-dark btn-sm" target="_blank">
                    <i class="bi bi-github"></i> GitHub
                </a>
                <a th:if="${profile.linkedinUrl}" th:href="${profile.linkedinUrl}" class="btn btn-primary btn-sm" target="_blank">
                    <i class="bi bi-linkedin"></i> LinkedIn
                </a>
                <a th:if="${profile.cvUrl}" th:href="${profile.cvUrl}" class="btn btn-danger btn-sm" target="_blank">
                    <i class="bi bi-file-earmark-person"></i> CV
                </a>
            </div>
        </header>

        <!-- 3.4. KỸ NĂNG CHUYÊN MÔN (SKILLS) -->
        <section class="container mb-5" th:if="${!skills.empty}">
            <h3 class="text-center mb-4 fw-bold" data-aos="fade-up" th:text="#{section.skills}">Kỹ năng chuyên môn</h3>
            <div class="row justify-content-center">
                <div class="col-md-8" data-aos="zoom-in">
                    <div class="row">
                        <div class="col-md-6 mb-3" th:each="skill : ${skills}">
                            <div class="d-flex justify-content-between">
                                <span class="fw-bold" th:text="${skill.name}">Java</span>
                                <span class="text-muted small" th:text="${skill.level} + '%'">80%</span>
                            </div>
                            <div class="progress" style="height: 10px;">
                                <div class="progress-bar"
                                     role="progressbar"
                                     th:style="'width: ' + ${skill.level} + '%'"
                                     th:classappend="${skill.level > 80} ? 'bg-success' : (${skill.level > 50} ? 'bg-info' : 'bg-warning')">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3.5. DỰ ÁN TIÊU BIỂU (PROJECTS) -->
        <section class="container mt-5 mb-5">
            <h2 class="mb-4 text-center fw-bold" data-aos="fade-up" th:text="#{section.projects}">Dự án tiêu biểu</h2>
            <div class="row g-4">
                <div class="col-md-4" th:each="p : ${projects}" data-aos="flip-left">
                    <div class="card h-100 shadow-sm">
                        <!-- Ảnh dự án -->
                        <img th:if="${p.imageUrl}" th:src="${p.imageUrl}" class="card-img-top" style="height: 200px; object-fit: cover;">

                        <div class="card-body">
                            <h5 class="card-title fw-bold" th:text="${p.title}">Title</h5>
                            <h6 class="card-subtitle mb-2 small" th:text="${p.role}">Role</h6>
                            <p class="card-text text-truncate" th:text="${p.description}">Desc</p>
                            <small class="" th:text="'Client: ' + ${p.client}"></small>
                        </div>

                        <div class="card-footer bg-custom-white border-top-0 pb-3">
                            <a th:if="${p.projectUrl}" th:href="${p.projectUrl}" class="btn btn-outline-primary btn-sm w-100" target="_blank" th:text="#{btn.details}">Xem chi tiết</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3.6. FORM LIÊN HỆ (CONTACT) -->
        <section class="bg-custom-light py-5" id="contact">
            <div class="container">
                <h2 class="text-center mb-4 fw-bold" data-aos="fade-up" th:text="#{section.contact}">Liên hệ với tôi</h2>

                <div class="row justify-content-center">
                    <div class="col-md-6" data-aos="fade-up" data-aos-delay="200">
                        <div class="card shadow p-4 border-0">
                            <form th:action="@{/contact/send}" method="POST">
                                <div class="mb-3">
                                    <label class="form-label small fw-bold" th:text="#{contact.name}">TÊN CỦA BẠN</label>
                                    <input type="text" name="senderName" class="form-control" required th:placeholder="#{contact.name}">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small fw-bold" th:text="#{contact.email}">EMAIL LIÊN HỆ</label>
                                    <input type="email" name="senderEmail" class="form-control" required placeholder="name@example.com" th:placeholder="#{contact.email}">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small fw-bold" th:text="#{contact.message}">LỜI NHẮN</label>
                                    <textarea name="content" class="form-control" rows="4" required th:placeholder="#{contact.message}"></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary w-100 py-2" th:text="#{contact.send}">Gửi tin nhắn</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3.7. FOOTER -->
        <footer class="text-center py-4 text-muted small">
            &copy; 2025 My Portfolio. Built with Spring Boot.
        </footer>

        <!-- 3.8. NÚT BACK TO TOP -->
        <button id="btn-back-to-top" type="button" class="btn btn-primary btn-lg rounded-circle shadow"
                style="position: fixed; bottom: 20px; right: 20px; display: none; z-index: 1000;">
            <i class="bi bi-arrow-up"></i>
        </button>

        <!-- =================================================================================
             PHẦN 4: JAVASCRIPT (SCRIPTS)
        ================================================================================== -->

        <!-- 4.1. Thư viện JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
        <script src="https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js"></script>

        <!-- 4.2. Khởi tạo và Logic -->
        <script th:inline="javascript">
            // --- A. Khởi tạo AOS (Hiệu ứng cuộn) ---
            AOS.init({
                duration: 1000,
                once: true,
                offset: 100
            });

            // --- B. Khởi tạo Typed.js (Gõ chữ) ---
            if (document.getElementById('typed-text')) {
                var typed = new Typed('#typed-text', {
                    strings: ['Backend Developer', 'Software Engineer', 'Java Spring Coder'],
                    typeSpeed: 50,
                    backSpeed: 30,
                    loop: true
                });
            }

            // --- C. Xử lý Nút Back to Top ---
            let mybutton = document.getElementById("btn-back-to-top");
            window.onscroll = function () {
                if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                    mybutton.style.display = "block";
                } else {
                    mybutton.style.display = "none";
                }
            };
            mybutton.addEventListener("click", function () {
                window.scrollTo({top: 0, behavior: 'smooth'});
            });

            // --- D. Xử lý Preloader (Màn hình chờ) ---
            window.addEventListener("load", function () {
                var preloader = document.getElementById('preloader');
                preloader.style.opacity = '0';
                setTimeout(function () {
                    preloader.style.display = 'none';
                }, 500);
            });

            // --- E. Xử lý Thông báo Toast (SweetAlert2) ---
            const urlParams = new URLSearchParams(window.location.search);
            const isSent = urlParams.get('sent');

            if (isSent) {
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })

                Toast.fire({
                    icon: 'success',
                    title: 'Gửi tin nhắn thành công!'
                })

                // Xóa tham số trên URL
                window.history.replaceState(null, null, window.location.pathname);
            }

            // --- F. Xử lý Dark Mode (Chế độ tối) ---
            const toggleBtn = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            const body = document.body;

            // Kiểm tra xem người dùng đã lưu theme chưa
            const currentTheme = localStorage.getItem('theme');
            if (currentTheme) {
                body.setAttribute('data-theme', currentTheme);
                if (currentTheme === 'dark') {
                    themeIcon.classList.replace('bi-moon-stars-fill', 'bi-sun-fill');
                }
            }

            // Xử lý khi bấm nút
            toggleBtn.addEventListener('click', () => {
                if (body.getAttribute('data-theme') === 'dark') {
                    body.removeAttribute('data-theme');
                    themeIcon.classList.replace('bi-sun-fill', 'bi-moon-stars-fill');
                    localStorage.setItem('theme', 'light');
                } else {
                    body.setAttribute('data-theme', 'dark');
                    themeIcon.classList.replace('bi-moon-stars-fill', 'bi-sun-fill');
                    localStorage.setItem('theme', 'dark');
                }
            });
        </script>
    </body>
</html>