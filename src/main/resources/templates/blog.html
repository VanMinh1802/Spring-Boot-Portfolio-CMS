<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Blog Cá Nhân</title>
        <link rel="icon" type="image/png" href="/favicon.png">

        <!-- 1. Thư viện CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
        <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

        <!-- 2. CSS Tùy chỉnh & Dark Mode -->
        <style>
            :root {
                --bg-color: #f8f9fa;
                --text-color: #212529;
                --card-bg: #ffffff;
                --navbar-bg: #212529;
            }
            [data-theme="dark"] {
                --bg-color: #121212;
                --text-color: #e0e0e0;
                --card-bg: #1e1e1e;
            }
            body {
                font-family: 'Poppins', sans-serif;
                background-color: var(--bg-color);
                color: var(--text-color);
                transition: background-color 0.3s, color 0.3s;
            }
            .card {
                background-color: var(--card-bg);
                color: var(--text-color);
                border: none;
                transition: transform 0.3s;
            }
            .card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            }
            .btn {
                border-radius: 50px;
                padding-inline: 20px;
            }

            /* Input tìm kiếm trong Dark Mode */
            [data-theme="dark"] .form-control {
                background-color: #2c3034;
                border-color: #495057;
                color: #fff;
            }
            [data-theme="dark"] .form-control::placeholder {
                color: #adb5bd;
            }
        </style>
    </head>
    <body class="d-flex flex-column min-vh-100">

        <!-- Màn hình chờ -->
        <div id="preloader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #ffffff; z-index: 9999; display: flex; justify-content: center; align-items: center;">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status"></div>
        </div>

        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top shadow">
            <div class="container">
                <a class="navbar-brand fw-bold" href="/">My Portfolio</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <div class="ms-auto d-flex gap-2 align-items-center mt-3 mt-lg-0">
                        <a th:href="@{/}" class="btn btn-outline-light btn-sm border-0">Trang chủ</a>

                        <!-- Nút Dark Mode -->
                        <button class="btn btn-outline-light btn-sm border-0 me-2" id="theme-toggle" title="Đổi giao diện">
                            <i class="bi bi-moon-stars-fill" id="theme-icon"></i>
                        </button>

                        <!-- Logic Đăng nhập/Admin (Giống index.html) -->
                        <div sec:authorize="!isAuthenticated()">
                            <a th:href="@{/login}" class="btn btn-outline-light btn-sm"><i class="bi bi-box-arrow-in-right"></i> Đăng nhập</a>
                        </div>
                        <div sec:authorize="isAuthenticated()" class="d-flex gap-2">
                            <a sec:authorize="hasRole('ADMIN')" th:href="@{/admin/dashboard}" class="btn btn-warning btn-sm"><i class="bi bi-speedometer2"></i> Dashboard</a>
                            <form th:action="@{/logout}" method="POST" class="m-0">
                                <button type="submit" class="btn btn-danger btn-sm"><i class="bi bi-power"></i></button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Header -->
        <div class="container mt-5">
            <div class="text-center mb-5">
                <h1 class="fw-bold" data-aos="fade-down">Chia sẻ kiến thức</h1>
                <p class="text-muted">Nơi tôi viết về Lập trình, Công nghệ và Cuộc sống</p>
            </div>

            <!-- Thanh tìm kiếm -->
            <div class="row justify-content-center mb-5" data-aos="fade-up">
                <div class="col-md-6">
                    <form action="/blog" method="get" class="d-flex shadow-sm rounded-pill overflow-hidden border" style="background-color: var(--card-bg);">
                        <input type="text" name="keyword" th:value="${keyword}" class="form-control border-0 shadow-none px-4 py-3" placeholder="Tìm kiếm bài viết...">
                        <button type="submit" class="btn border-0 px-4 text-primary"><i class="bi bi-search"></i></button>
                    </form>
                </div>
            </div>

            <!-- Danh sách bài viết -->
            <div class="row">
                <div th:if="${#lists.isEmpty(posts)}" class="col-12 text-center">
                    <p class="text-muted">Chưa có bài viết nào được đăng.</p>
                </div>

                <div class="col-md-4 mb-4" th:each="post : ${posts}" data-aos="zoom-in">
                    <div class="card h-100 shadow-sm border-0">
                        <img th:if="${post.imageUrl}" th:src="${post.imageUrl}" class="card-img-top" style="height: 200px; object-fit: cover;">
                        <div th:unless="${post.imageUrl}" class="card-img-top bg-secondary d-flex align-items-center justify-content-center text-white" style="height: 200px;">
                            <span>No Image</span>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <div class="mb-2 text-muted small">
                                <i class="bi bi-calendar3"></i> <span th:text="${#temporals.format(post.createdTime, 'dd-MM-yyyy')}"></span>
                            </div>
                            <h5 class="card-title fw-bold">
                                <a th:href="@{/blog/{id}(id=${post.id})}" class="text-decoration-none" style="color: var(--text-color);" th:text="${post.title}">Tiêu đề</a>
                            </h5>
                            <p class="card-text text-muted flex-grow-1" th:text="${post.summary}">Tóm tắt...</p>
                            <a th:href="@{/blog/{id}(id=${post.id})}" class="btn btn-outline-primary mt-3">Đọc tiếp →</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center py-4 text-muted mt-auto border-top">
            <small>&copy; 2025 My Portfolio.</small>
        </footer>

        <!-- Nút Back to Top -->
        <button id="btn-back-to-top" class="btn btn-primary btn-lg rounded-circle shadow" style="position: fixed; bottom: 20px; right: 20px; display: none; z-index: 1000;">
            <i class="bi bi-arrow-up"></i>
        </button>

        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
        <script>
            AOS.init({duration: 1000, once: true});

            // Logic Back to Top & Preloader & Dark Mode (Giống index.html)
            // ... (Bạn copy đoạn script chung ở index.html vào đây để dùng chung logic) ...

            // --- Rút gọn cho ngắn, bạn copy y hệt từ index.html nhé ---
            const toggleBtn = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            const body = document.body;
            const currentTheme = localStorage.getItem('theme');
            if (currentTheme) {
                body.setAttribute('data-theme', currentTheme);
                if (currentTheme === 'dark')
                    themeIcon.classList.replace('bi-moon-stars-fill', 'bi-sun-fill');
            }
            toggleBtn.addEventListener('click', () => {
                if (body.getAttribute('data-theme') === 'dark') {
                    body.removeAttribute('data-theme');
                    themeIcon.classList.replace('bi-sun-fill', 'bi-moon-stars-fill');
                    localStorage.setItem('theme', 'light');
                } else {
                    body.setAttribute('data-theme', 'dark');
                    themeIcon.classList.replace('bi-moon-stars-fill', 'bi-sun-fill');
                    localStorage.setItem('theme', 'dark');
                }
            });

            let mybutton = document.getElementById("btn-back-to-top");
            window.onscroll = function () {
                if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20)
                    mybutton.style.display = "block";
                else
                    mybutton.style.display = "none";
            };
            mybutton.addEventListener("click", () => window.scrollTo({top: 0, behavior: 'smooth'}));

            window.addEventListener("load", () => {
                document.getElementById('preloader').style.display = 'none';
            });
        </script>
    </body>
</html>