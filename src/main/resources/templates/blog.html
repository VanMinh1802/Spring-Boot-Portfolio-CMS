<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title th:text="#{menu.blog} + ' - My Portfolio'">Blog</title>
        <link rel="icon" type="image/png" href="/favicon.png">

        <!-- Libraries -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
        <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">

        <style>
            :root {
                --bg-color: #f9fafb;
                --text-color: #4b5563;
                --heading-color: #111827;
                --card-bg: #ffffff;
                --primary-color: #4f46e5; /* M√†u t√≠m xanh hi·ªán ƒë·∫°i */
                --border-radius: 16px;
            }
            [data-theme="dark"] {
                --bg-color: #111827;
                --text-color: #9ca3af;
                --heading-color: #f9fafb;
                --card-bg: #1f2937;
                --primary-color: #818cf8;
            }

            body {
                font-family: 'Plus Jakarta Sans', sans-serif;
                background-color: var(--bg-color);
                color: var(--text-color);
                transition: background-color 0.3s, color 0.3s;
            }

            /* NAVBAR (Gi·ªëng trang ch·ªß) */
            .navbar {
                background: rgba(33, 37, 41, 0.95) !important;
                backdrop-filter: blur(10px);
                border-bottom: 1px solid rgba(255,255,255,0.1);
            }

            /* --- BLOG CARD STYLING --- */
            .blog-card {
                background-color: var(--card-bg);
                border-radius: var(--border-radius);
                overflow: hidden;
                border: 1px solid rgba(0,0,0,0.05);
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                height: 100%;
                display: flex;
                flex-direction: column;
            }

            .blog-card:hover {
                transform: translateY(-8px);
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
                border-color: var(--primary-color);
            }

            .card-img-wrapper {
                position: relative;
                height: 220px;
                overflow: hidden;
            }

            .card-img-top {
                width: 100%;
                height: 100%;
                object-fit: cover;
                transition: transform 0.6s ease;
            }

            .blog-card:hover .card-img-top {
                transform: scale(1.05);
            }

            /* Badge ng√†y th√°ng n·ªïi tr√™n ·∫£nh */
            .date-badge {
                position: absolute;
                top: 15px;
                right: 15px;
                background: rgba(255, 255, 255, 0.9);
                color: #111;
                padding: 6px 12px;
                border-radius: 20px;
                font-size: 0.8rem;
                font-weight: 700;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                backdrop-filter: blur(4px);
            }

            .card-body {
                padding: 24px;
                flex-grow: 1;
                display: flex;
                flex-direction: column;
            }

            .blog-title {
                font-size: 1.25rem;
                font-weight: 700;
                color: var(--heading-color);
                margin-bottom: 12px;
                line-height: 1.4;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }

            .blog-title a {
                color: inherit;
                text-decoration: none;
                transition: color 0.2s;
            }

            .blog-title a:hover {
                color: var(--primary-color);
            }

            .blog-summary {
                font-size: 0.95rem;
                margin-bottom: 20px;
                display: -webkit-box;
                -webkit-line-clamp: 3;
                -webkit-box-orient: vertical;
                overflow: hidden;
                color: var(--text-color);
                flex-grow: 1;
            }

            .read-more-btn {
                color: var(--primary-color);
                font-weight: 600;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                gap: 5px;
                transition: gap 0.3s;
            }

            .read-more-btn:hover {
                gap: 10px; /* Hi·ªáu ·ª©ng m≈©i t√™n ch·∫°y ra xa */
            }

            /* Search Bar */
            .search-box {
                background-color: var(--card-bg);
                border: 1px solid rgba(0,0,0,0.1);
                transition: all 0.3s;
            }
            .search-box:focus-within {
                border-color: var(--primary-color);
                box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
            }
            .search-input {
                background: transparent;
                color: var(--heading-color);
            }
            .search-input::placeholder {
                color: #9ca3af;
            }
            .search-input:focus {
                box-shadow: none;
                background: transparent;
                color: var(--heading-color);
            }

            /* 1. √âp ti√™u ƒë·ªÅ b√†i vi·∫øt v√† link th√†nh m√†u tr·∫Øng s√°ng */
            [data-theme="dark"] .card-title,
            [data-theme="dark"] .card-title a {
                color: #f8f9fa !important;
            }

            /* 2. √âp d√≤ng ch·ªØ m·ªù (text-muted) th√†nh m√†u x√°m s√°ng cho d·ªÖ ƒë·ªçc */
            [data-theme="dark"] .text-muted {
                color: #adb5bd !important;
            }

            /* 3. √âp n·ªôi dung m√¥ t·∫£ th√†nh m√†u tr·∫Øng */
            [data-theme="dark"] .card-text {
                color: #e0e0e0 !important;
            }
        </style>
    </head>
    <body class="d-flex flex-column min-vh-100">

        <!-- M√†n h√¨nh ch·ªù -->
        <div id="preloader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 9999; display: flex; justify-content: center; align-items: center;">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status"></div>
        </div>

        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top shadow-sm">
            <div class="container">
                <a class="navbar-brand fw-bold" href="/">My Portfolio</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <div class="ms-auto d-flex gap-2 align-items-center mt-3 mt-lg-0">
                        <div class="me-2">
                            <a href="?lang=vi" class="text-decoration-none me-2">üáªüá≥</a>
                            <a href="?lang=en" class="text-decoration-none">üá∫üá∏</a>
                        </div>
                        <a th:href="@{/}" class="btn btn-outline-light btn-sm border-0" th:text="#{menu.home}">Trang ch·ªß</a>
                        <button class="btn btn-outline-light btn-sm border-0 me-2" id="theme-toggle"><i class="bi bi-moon-stars-fill" id="theme-icon"></i></button>

                        <div sec:authorize="!isAuthenticated()">
                            <a th:href="@{/login}" class="btn btn-primary btn-sm"><i class="bi bi-box-arrow-in-right"></i> <span th:text="#{menu.login}">Login</span></a>
                        </div>
                        <div sec:authorize="isAuthenticated()" class="d-flex gap-2">
                            <a sec:authorize="hasRole('ADMIN')" th:href="@{/admin/dashboard}" class="btn btn-warning btn-sm"><i class="bi bi-speedometer2"></i> <span th:text="#{menu.dashboard}">Dash</span></a>
                            <form th:action="@{/logout}" method="POST" class="m-0"><button type="submit" class="btn btn-danger btn-sm"><i class="bi bi-power"></i></button></form>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Header Section -->
        <div class="container mt-5">
            <div class="text-center mb-5">
                <h1 class="display-5 fw-bold" style="color: var(--heading-color);" data-aos="fade-down" th:text="#{blog.title}">Blog</h1>
                <p class="fs-5" style="color: var(--text-color);" th:text="#{blog.subtitle}">Stories & Ideas</p>
            </div>

            <!-- Search Bar -->
            <div class="row justify-content-center mb-5" data-aos="fade-up">
                <div class="col-md-6">
                    <form action="/blog" method="get" class="d-flex shadow-sm rounded-pill overflow-hidden search-box">
                        <input type="text" name="keyword" th:value="${keyword}"
                               class="form-control border-0 px-4 py-3 search-input"
                               th:placeholder="#{blog.search}">
                        <button type="submit" class="btn border-0 px-4 text-primary"><i class="bi bi-search"></i></button>
                    </form>
                </div>
            </div>

            <!-- Blog Grid -->
            <div class="row g-4">
                <!-- Empty State -->
                <div th:if="${#lists.isEmpty(posts)}" class="col-12 text-center py-5">
                    <div class="text-muted mb-3"><i class="bi bi-journal-x" style="font-size: 3rem;"></i></div>
                    <p class="fs-5" th:text="#{blog.empty}">Ch∆∞a c√≥ b√†i vi·∫øt n√†o.</p>
                </div>

                <!-- Blog Item -->
                <div class="col-md-4" th:each="post : ${posts}" data-aos="fade-up">
                    <article class="blog-card">
                        <div class="card-img-wrapper">
                            <!-- ·∫¢nh b√¨a -->
                            <img th:if="${post.imageUrl}" th:src="${post.imageUrl}" class="card-img-top">
                            <div th:unless="${post.imageUrl}" class="card-img-top bg-secondary d-flex align-items-center justify-content-center text-white">
                                <i class="bi bi-image fs-1"></i>
                            </div>
                            <!-- Badge ng√†y th√°ng -->
                            <div class="date-badge">
                                <i class="bi bi-calendar3 me-1"></i>
                                <span th:text="${#temporals.format(post.createdTime, 'dd/MM/yyyy')}"></span>
                            </div>
                        </div>

                        <div class="card-body">
                            <h3 class="blog-title">
                                <a th:href="@{/blog/{id}(id=${post.id})}" th:text="${post.title}">Ti√™u ƒë·ªÅ b√†i vi·∫øt</a>
                            </h3>
                            <p class="blog-summary" th:text="${post.summary}">M√¥ t·∫£ ng·∫Øn...</p>

                            <div class="mt-auto">
                                <a th:href="@{/blog/{id}(id=${post.id})}" class="read-more-btn">
                                    <span th:text="#{blog.readmore}">ƒê·ªçc ti·∫øp</span> <i class="bi bi-arrow-right"></i>
                                </a>
                            </div>
                        </div>
                    </article>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center py-5 mt-auto border-top" style="border-color: rgba(0,0,0,0.05) !important;">
            <p class="mb-0 text-muted small">&copy; 2025 My Portfolio</p>
        </footer>

        <!-- Back to Top -->
        <button id="btn-back-to-top" class="btn btn-primary btn-lg rounded-circle shadow" style="position: fixed; bottom: 20px; right: 20px; display: none; z-index: 1000;"><i class="bi bi-arrow-up"></i></button>

        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
        <script>
            AOS.init({duration: 800, once: true});

            // Dark Mode Logic
            const toggleBtn = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            const currentTheme = localStorage.getItem('theme');
            if (currentTheme) {
                document.documentElement.setAttribute('data-theme', currentTheme);
                if (currentTheme === 'dark')
                    themeIcon.classList.replace('bi-moon-stars-fill', 'bi-sun-fill');
            }
            toggleBtn.addEventListener('click', () => {
                if (document.documentElement.getAttribute('data-theme') === 'dark') {
                    document.documentElement.removeAttribute('data-theme');
                    themeIcon.classList.replace('bi-sun-fill', 'bi-moon-stars-fill');
                    localStorage.setItem('theme', 'light');
                } else {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    themeIcon.classList.replace('bi-moon-stars-fill', 'bi-sun-fill');
                    localStorage.setItem('theme', 'dark');
                }
            });

            // Back to top & Preloader
            let mybutton = document.getElementById("btn-back-to-top");
            window.onscroll = function () {
                mybutton.style.display = (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) ? "block" : "none";
            };
            mybutton.addEventListener("click", () => window.scrollTo({top: 0, behavior: 'smooth'}));
            window.addEventListener("load", () => document.getElementById('preloader').style.display = 'none');
        </script>
    </body>
</html>